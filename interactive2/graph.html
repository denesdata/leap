<!doctype html>
<html>

<head>

  <meta charset="utf-8">
  <title>Horizontal Bar Chart | D3plus</title>

  <script src="//d3js.org/d3.v4.min.js"></script>
  <!-- <script src="https://d3plus.org/js/d3plus-plot.v0.9.full.min.js"></script> -->
  <script src="src/d3plus2.js"></script>
  <!-- <script src="https://d3plus.org/js/d3plus-hierarchy.v0.9.full.min.js"></script> -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700,900">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,900">
  <style>
    body {
      margin: 0;
      font-family: "Roboto Condensed" !important;
    }

    .viz {
      width: 250px;
      /* min-height: 300px; */
      /* max-height: 600px; */
      background: rgb(164, 151, 59);
      display: inline-block;
    }

    #table {
      /* display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); */
    }

    text {
      font-family: "Roboto Condensed" !important;
      /* fill: #fff !important; */
    }

    .d3plus-viz-title text,
    .d3plus-Line-text text {
      fill: #fff !important;
    }

    .d3plus-Line-text text {
      font-size: 12px !important;
    }

    .d3plus-viz-title text {
      font-size: 14px !important;
    }
  </style>

</head>

<body>

  <div id='table'></div>

  <script>

    function colorizer(d) {
      if (d == 'children') return d3.rgb(255, 255, 255, 0.6)
      else if (d == 'youth') return d3.rgb(255, 255, 255, 0.8)
      else if (d == 'parents') return d3.rgb(255, 255, 255, 1)
      else if (d == 'teachers') return d3.rgb(255, 255, 255, 0.4)
      else if (d == 'sometimes') return d3.rgb(255, 255, 255, 0.6)
      else if (d == 'always') return d3.rgb(255, 255, 255, 1)
      else if (d == 'never') return d3.rgb(255, 255, 255, 0.2)
      else if (d == 'almost everyday') return d3.rgb(255, 255, 255, 1)
      else if (d == '7-14 days') return d3.rgb(255, 255, 255, 0.8)
      else if (d == '4-6 days') return d3.rgb(255, 255, 255, 0.6)
      else if (d == '1-3 days') return d3.rgb(255, 255, 255, 0.4)
      else if (d == 'not one day') return d3.rgb(255, 255, 255, 0.2)
      else if (d == 'almost everyday') return d3.rgb(255, 255, 255, 1)
      else if (d == 'at least once a week') return d3.rgb(255, 255, 255, 0.8)
      else if (d == 'several times a month') return d3.rgb(255, 255, 255, 0.6)
      else if (d == 'once a month or less') return d3.rgb(255, 255, 255, 0.4)
      else return d3.rgb(255, 255, 255, 0.5)
    }

    d3.json('data/nodes_edges_table_lessons3.json', function (rawdata) {
      data = rawdata.graphs;
      console.log(data);
      Object.keys(data).forEach(function (i) {
        console.log(i)
        size = (new Set(data[i].data.map(value => value.option))).size *
          (new Set(data[i].data.map(value => value.id))).size + 4
        var barHeight = 7
        size = size * barHeight
        // size = Math.max(300, Math.min(size, 600))
        if (i > 4) {
          d3.select('#table').append('div')
            .attr('id', 'viz' + i)
            .classed('viz', true)
            .style('height', (size) + 'px')
          // new d3plus.Pack()
          //   .select('#viz' + i)
          //   .data(data[i].data)
          //   .title(data[i].title)
          //   .color(function (d) { return colorizer(d.id) })
          //   .sum("value")
          //   .groupBy(['id',"option"])
          // .legend(false)
          //   .render();
          new d3plus.BarChart()
            .select('#viz' + i)
            .config({
              data: data[i].data,
              // title: ((data[i].title == 'None') ? false : data[i].title),
              // barPadding: 1,
              // groupPadding: 5,
              x: "value",
              y: "option",
              discrete: 'y',
              loadingMessage: false,
              height: size,
              color: function (d) { return colorizer(d.id) },
              yConfig: {
                // maxSize: 100,
                // paddingOuter: 120,
                barConfig: {
                  // "stroke-width": 0,
                  stroke: 'white',
                },
                gridConfig: { stroke: "transparent" },
                shapeConfig: { stroke: "white" },
                labelOffset: false,
                // labelConfig: {
                //   fontSize: 22,
                // }
              },
              xConfig: {
                barConfig: {
                  // "stroke-width": 0,
                  stroke: 'white',
                },
                gridConfig: { stroke: "transparent" },
                shapeConfig: {
                  stroke: "white",
                },
              },
              shapeConfig: {
                tooltipConfig: {
                  title: function (d) {
                    return d["id"];
                  },
                },
                  tbody: [
                    [function (d) { return d["option"] + ': ' }, function (d) { return d["value"] + " %" }]
                  ],
                
                // lineLabels:true,
                // lineMarkers: true,
                // sizeMax: 100,
                // shapeConfig: {
                //   labelConfig: {
                //     fontColor: 'red',
                //     fontMin: 1
                //   },
                // },
                label: function (d) { return d["value"] },
              },
              legend: false
            })
            .render();
        }
      })
    })
  </script>

</body>

</html>